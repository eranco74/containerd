# Generated by Butane; do not edit
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 98-containerd-config
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            compression: ""
            source: data:;base64,W3BsdWdpbnNdCiAgW3BsdWdpbnMuY3JpLmNuaV0KICBiaW5fZGlyID0gIi92YXIvbGliL2NuaS9iaW4iCiAgY29uZl9kaXIgPSAiL3Zhci9ydW4vbXVsdHVzL2NuaS9uZXQuZC8i
          mode: 420
          path: /etc/containerd/config.toml
        - contents:
            compression: gzip
            source: data:;base64,H4sIAAAAAAAC/yoqzSvJzE3VTc1LKcjPzCuxUijNy6yw0tfXLyrN00/OzytJzMxLLUpBYuoV5ydnc2XmJqaTrg0QAAD//3H8xzlvAAAA
          mode: 420
          path: /etc/crictl.yaml
        - contents:
            compression: gzip
            source: data:;base64,H4sIAAAAAAAC/5yUTU/bQBCG7/4VA6lEe1gv4UuIikNVOLSHUiFudVVtdsfxCntm2Y8EUH98tY4diAA1rRQp0mjmmXdez85kR6bg5cySRFrATIWmCBhBYOJLcNZhrWwLkwmIS2AXLRMsbduCVikg1Il0jgWIDJYa9DZC9MoVRWFr+AGiBo+uVRqF9pbF0sZGaKaoLKE3pWFC+PkRYoNUAKBuGHa/cWwszTPT8G4O39sI+0VtR+zOCtzxYsV9nXOdEzIop2SOd53gED0i8AK9twYHCrx7710H4k7B77lHl0sEfygAIifdvOjVa3mSYilE1bbDZEhvTXbBS2pZmV7U2oUsTSffgrgC8RWaGN2ZlE7pWzXHUGISGil61YppqTr1yKSWodTcyYP96Wm5fyiTMypikMogzo6Pj2aqPpb3pye/To7k94EjnxqKaXlUTg/FQZmBjzQtV7mld12xFvtlNdRLrc9sHAaHLdmjnW/4tfrCk5uri6szIESTVyD/GhsgcIfAsUEPS/XwzHzNVNt58ihu0wxbjK97/3lMgyEtjzKBm57dcGoNrGzMZXCNd8l6DKDIwKc6ogeDDskgaYuhAAhoQFgIe7LfioB+YTU+c3kd2puDxKhleAgROzP8y1HtkFZsMMXTKxE+UbQdCiTj2FI8r+RC+Ur6RFXfvBoksL79h8K10GpDdIZsqXhT8NhNzz0nF86roawMrdVYbdq0Rfp/Gzlu2euL0S/Z+BwJh/s0ngnIF2pj38cD8JcrNjKvccYc+/PVIBAb3C18Hyv+BAAA//8UjlOcbQUAAA==
          mode: 484
          path: /usr/local/bin/replace-crio-with-containerd.sh
    systemd:
      units:
        - contents: |
            [Unit]
            Description=containerd container runtime
            Documentation=https://containerd.io
            After=network.target local-fs.target replace-crio-with-containerd.service
            [Service]
            ExecStartPre=-/sbin/modprobe overlay
            ExecStart=/bin/containerd --config /etc/containerd/config.toml
            Type=notify
            Delegate=yes
            KillMode=process
            Restart=always
            RestartSec=5
            # Having non-zero Limit*s causes performance problems due to accounting overhead
            # in the kernel. We recommend using cgroups to do container-local accounting.
            LimitNPROC=infinity
            LimitCORE=infinity
            LimitNOFILE=infinity
            # Comment TasksMax if your systemd version does not supports it.
            # Only systemd 226 and above support this version.
            TasksMax=infinity
            OOMScoreAdjust=-999
            [Install]
            WantedBy=multi-user.target
          enabled: true
          name: containerd.service
        - contents: |
            [Install]
            WantedBy=multi-user.target
            [Unit]
            Description=Fake CRI-O socket for OpenShift SDN
            Requires=containerd.service
            After=containerd.service
            [Service]
            Type=oneshot
            ExecStart=/bin/sh -c "mkdir -p /var/run/crio && touch /var/run/crio/crio.sock && mount --bind /var/run/containerd/containerd.sock /var/run/crio/crio.sock"
          enabled: true
          name: fake-crio-sock-for-sdn.service
        - contents: |
            [Install]
            WantedBy=multi-user.target
            [Unit]
            Description=replace CRI-O with containerd
            Requires=network.target
            After=ostree-finalize-staged.service
            [Service]
            Type=oneshot
            Restart=on-failure
            RestartSec=30
            ExecStartPre=/bin/mkdir -p /opt/replace-crio-with-containerd
            WorkingDirectory=-/opt/replace-crio-with-containerd
            ExecStart=/usr/local/bin/replace-crio-with-containerd.sh
          enabled: true
          name: replace-crio-with-containerd.service
